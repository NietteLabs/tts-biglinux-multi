#!/bin/bash

#Translation
export TEXTDOMAINDIR="/usr/share/locale"
export TEXTDOMAIN=tts-biglinux

# Don't group windows
xprop -id "$(xprop -root '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)" -f WM_CLASS 8s -set WM_CLASS "$$"

FOLDER_CONFIG="$HOME/.config/tts-biglinux"
mkdir -p ~/.config/tts-biglinux


RATE="$(cat ${FOLDER_CONFIG}/rate)"
PITCH="$(cat ${FOLDER_CONFIG}/pitch)"
VOLUME="$(cat ${FOLDER_CONFIG}/volume)"
VOICE="$(cat ${FOLDER_CONFIG}/voice)"

if [ "$RATE" = "" ]; then
    RATE="-25"
    echo "$RATE" > ${FOLDER_CONFIG}/rate
fi

if [ "$PITCH" = "" ]; then
    PITCH="-25"
    echo "$PITCH" > ${FOLDER_CONFIG}/pitch
fi

if [ "$VOLUME" = "" ]; then
    VOLUME="0"
    echo "$VOLUME" > ${FOLDER_CONFIG}/volume
fi

if [ "$VOICE" = "" ]; then

    if ["$(echo "$LANG" | grep pt)" != "" ]; then
        VOICE="Letícia-F123"
    else
        VOICE="Evgeniy-Eng"
    fi

    echo "$VOICE" > ${FOLDER_CONFIG}/voice
fi


# Import BigControlCenter base modules / Importa os módulos básicos do BigControlCenter
# That's include jquery and materialize / Isso inclui o jquery e o materialize
# http://materializecss.com/
. /usr/share/bigbashview/bcc/shell/base.sh

  echo '
  <body>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/usr/share/bigbashview/bcc/css/base.css">
    <link rel="stylesheet" type="text/css" href="/usr/share/bigbashview/bcc/materialize/css/materialize.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="/usr/share/bigbashview/bcc/materialize/js/jquery.js"></script>
    <script src="/usr/share/bigbashview/bcc/materialize/js/materialize.js"></script>
    <script src="/usr/share/bigbashview/bcc/js/big.js"></script>
  </head>'
  echo '<title>' $"Texto para voz" '</title>'
  echo '<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />'



echo '<div id=page2>'
echo '<div id="middle" class="bar"><h1>'

  echo $"Para falar um texto selecionado você pode utilizar o atalho tecla [Meta] + [V], a tecla Meta também é conhecida como Super ou Windows. Outra opção é utilizar o ícone que está na sessão Utilitários no menu do sistema."
  echo "<br><br>"
  echo $"Você pode utilizar o mesmo ícone ou atalho para interromper um texto que está sendo falado."
  echo "<br><br>"
  echo $"Selecione as configurações de sua preferência:"
  echo "<br><br>"
  
  echo "<form name=noise action=make.sh.htm>"



#################
# Speed
#################
tooltiprate=$"Números maiores deixam a voz mais rápida, o padrão é: -25"

echo "<div id=content>"
echo "<div id=center class=\"tooltipped with-gap\" data-position=\"top\" data-delay=\"250\" data-tooltip=\"$tooltiprate\">"
echo "<label>" $"Velocidade" "</label>"
echo "<select class=browser-default id=RATE name=RATE>"

for i  in "100" "95" "90" "85" "75" "70" "65" "60" "55" "50" "45" "40" "35" "30" "25" "20" "15" "10" "5" "0" "-5" "-10" "-15" "-20" "-25" "-30" "-35" "-40" "-45" "-50" "-55" "-60" "-65" "-70" "-75" "-80" "-85" "-90" "-95" "-100"; do

	if [ "$i" = "$RATE" ]; then
		    echo "<option value=\"$i\" selected>$i</option>"
	else
	    echo "<option value=\"$i\">$i</option>"
	fi

done
echo '</select>'
echo "</div>"



#################
# Pitch
#################
tooltipitch=$"Números maiores deixam a voz mais aguda, o padrão é: -25"

echo "<div id=center class=\"tooltipped with-gap\" data-position=\"top\" data-delay=\"250\" data-tooltip=\"$tooltipitch\">"
echo "<label>" $"Tom" "</label>"
echo "<select class=browser-default id=PITCH name=PITCH>"

for i  in "100" "95" "90" "85" "75" "70" "65" "60" "55" "50" "45" "40" "35" "30" "25" "20" "15" "10" "5" "0" "-5" "-10" "-15" "-20" "-25" "-30" "-35" "-40" "-45" "-50" "-55" "-60" "-65" "-70" "-75" "-80" "-85" "-90" "-95" "-100"; do

	if [ "$i" = "$PITCH" ]; then
		    echo "<option value=\"$i\" selected>$i</option>"
	else
	    echo "<option value=\"$i\">$i</option>"
	fi

done
echo '</select>'
echo "</div>"


#################
# Volume
#################
tooltipvolume=$"O padrão é: 0."

echo "<div id=center class=\"tooltipped with-gap\" data-position=\"top\" data-delay=\"250\" data-tooltip=\"$tooltipvolume\">"
echo "<label>" $"Volume" "</label>"
echo "<select class=browser-default id=VOLUME name=VOLUME>"

for i  in "100" "95" "90" "85" "75" "70" "65" "60" "55" "50" "45" "40" "35" "30" "25" "20" "15" "10" "5" "0" "-5" "-10" "-15" "-20" "-25" "-30" "-35" "-40" "-45" "-50" "-55" "-60" "-65" "-70" "-75" "-80" "-85" "-90" "-95" "-100"; do

	if [ "$i" = "$VOLUME" ]; then
		    echo "<option value=\"$i\" selected>$i</option>"
	else
	    echo "<option value=\"$i\">$i</option>"
	fi

done
echo '</select>'
echo "</div></div>"


#################
# Voice
#################
tooltipvoice=$"As vozes são otimizadas para idiomas expecíficos."


echo "<div id=center class=\"tooltipped with-gap\" data-position=\"top\" data-delay=\"250\" data-tooltip=\"$tooltipvoice\">"
echo "<label>" $"Voz" "</label>"
echo "<select class=browser-default id=VOICE name=VOICE>"

OIFS=$IFS
IFS=$'\n'

for i  in $(spd-say -L -o rhvoice | tail -n +2); do

VOICE_ITEM="$(echo "$i" | awk  '{print $1}')"
LANG_ITEM="$(echo "$i" | awk  '{print $2}')"

	if [ "$VOICE_ITEM" = "$VOICE" ]; then
		    echo "<option value=\"$VOICE_ITEM\" selected>$VOICE_ITEM - $LANG_ITEM</option>"
	else
	    echo "<option value=\"$VOICE_ITEM\">$VOICE_ITEM - $LANG_ITEM</option>"
	fi

done

echo '</select>'
echo "</div>"


echo "<div id=buttons>"

tooltipinstall=$"Após instalar ou remover uma voz abra novamente este configurador"
echo "<div id=theme2-2 class=\"tooltipped with-gap\" data-position=\"top\" data-delay=\"250\" data-tooltip=\"$tooltipinstall\">
<a class=\"waves-effect waves-light btn-large\" href=\"#\" onclick=\"_run('big-store rhvoice-voice')\">" $"Instalar ou remover vozes" '</a>
</form>'


# run bash scripts
cat << EOF
<script>
\$('#PITCH').on('change', function() {
    _run('./pitch.run ' + \$(this).find(":selected").val());
});

\$('#RATE').on('change', function() {
    _run('./rate.run ' + \$(this).find(":selected").val());
});

\$('#VOLUME').on('change', function() {
    _run('./volume.run ' + \$(this).find(":selected").val());
});

\$('#VOICE').on('change', function() {
    _run('./voice.run ' + \$(this).find(":selected").val());
});

</script>
EOF


echo "</div></div>"
IFS=$OIFS
